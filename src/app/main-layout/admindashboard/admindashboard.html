<table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th>Title</th>
      <th>Make</th>
      <th>Images</th>
      <th>Price</th>
      <th>Buyer Details</th>
      <th>Action</th>
    </tr>
  </thead>

  <tbody>
    <tr *ngFor="let product of products">
      <!-- Product Details -->
      <td>{{ product.title }}</td>
      <td>{{ product.make }}</td>

      <!-- Product Images -->
      <td>
        <img
          *ngFor="let img of product.images"
          [src]="'data:' + img.mimetype + ';base64,' + img.data"
          [alt]="img.filename"
          width="60"
          height="60"
          style="margin: 4px; border-radius: 6px;"
        />
      </td>
 <td>{{ product.price }}</td>
      <!-- Buyer Details Section -->
      <td>
        <div *ngIf="product.buyerDetails && product.buyerDetails.length > 0; else noBuyers">
          <div
            *ngFor="let buyer of product.buyerDetails; let i = index"
            class="buyer-card"
            style="border: 1px solid #ddd; border-radius: 8px; padding: 6px; margin-bottom: 8px;"
          >
            <p><strong>#{{ i + 1 }}</strong></p>
            <p><strong>Status:</strong> {{ buyer.status || 'N/A' }}</p>
            <p><strong>Message:</strong> {{ buyer.message || 'N/A' }}</p>
            <p><strong>Phone:</strong> {{ buyer.contact_phone || 'N/A' }}</p>
            <p><strong>Contact Time:</strong> {{ buyer.preferred_contact_time || 'N/A' }}</p>
          </div>
        </div>

        <ng-template #noBuyers>
          <span>No buyer responses yet.</span>
        </ng-template>
      </td>

      <!-- Action Buttons -->
      <td>
        <input
          *ngIf="product.showReason"
          type="text"
          [(ngModel)]="product.reason"
          placeholder="Enter reason"
          required
        />

        <button *ngIf="!product.isActive" (click)="approveVehicle(product._id, product.reason)">
          Approve
        </button>

        <button *ngIf="product.isActive && !product.showReason" (click)="product.showReason = true">
          Rejected
        </button>

        <button
          *ngIf="product.isActive && product.showReason"
          [disabled]="!product.reason"
          (click)="deactivateVehicle(product._id, product.reason)"
        >
          Confirm Rejected
        </button>

        <button
          *ngIf="product.status !== 'sold'"
          class="btn btn-success"
          (click)="soldVehicle(product._id)"
        >
          Sold
        </button>

        <button *ngIf="product.status === 'sold'" class="btn btn-secondary" disabled>
          Sold
        </button>
      </td>
    </tr>
  </tbody>
</table>
<h2>Users</h2>
<table>
  <thead>
    <tr>
      <th>Email</th>
      <th>Phone</th>
      <th>Role</th> 
      <th>User Images</th>
      <th>Action</th>
    </tr>
  </thead>
 <tbody>
  <tr *ngFor="let user of users">
    <td>{{ user.email }}</td>
    <td>{{ user.phone }}</td>
    <td>{{ user.role}}</td> 
    <td>
  <div class="avatar" *ngIf="user?.avatar_url">
    <img
      [src]="user.avatar_url"
      alt="User Avatar"
      class="avatar-image"
    />
  </div>
</td>
    <td>
      <button 
        *ngIf="user.is_blocked === 'false'" 
        (click)="blockUser(user._id)">
        Block
      </button>
      <button 
        *ngIf="user.is_blocked === 'true'" 
        (click)="unblockUser(user._id)">
        Unblock
      </button>
    </td>
  </tr>
</tbody>
</table>