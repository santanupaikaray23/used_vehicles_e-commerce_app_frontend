<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Title</th>
      <th>Make</th>
      <th>Images</th>
      <th>Status</th>
      <th>Reason</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let product of products">
      <td>{{ product._id }}</td>
      <td>{{ product.title }}</td>
      <td>{{ product.make }}</td>
      <td>
        <img
          *ngFor="let img of product.images"
          [src]="'data:' + img.mimetype + ';base64,' + img.data"
          [alt]="img.filename"
          width="60"
          height="60"
        />
      </td>
      <td>{{ product.status }}</td>

      <!-- Reason box only when deactivating -->
      <td>
        <input
          *ngIf="product.showReason"
          type="text"
          [(ngModel)]="product.reason"
          placeholder="Enter reason"
          required
        />
      </td>

      <td>
        <!-- Approve button -->
        <button *ngIf="!product.isActive" (click)="approveVehicle(product._id, product.reason)">
          Approve
        </button>

        <!-- Step 1: First click shows the input box -->
        <button *ngIf="product.isActive && !product.showReason" (click)="product.showReason = true">
          Deactivate
        </button>

        <!-- Step 2: Confirm with reason -->
        <button
          *ngIf="product.isActive && product.showReason"
          [disabled]="!product.reason"
          (click)="deactivateVehicle(product._id, product.reason)"
        >
          Confirm Deactivate
        </button>
        <button (click)="deleteVehicles(product._id)">
          Delete Permanently
        </button>
      </td>
    </tr>
  </tbody>
</table>

<!-- Users Table -->
<h2>Users</h2>
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Email</th>
      <th>Phone</th>
      <th>City</th>
      <th>Status</th>
      <th>Reason</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let user of users">
      <td>{{ user._id }}</td>
      <td>{{ user.email }}</td>
      <td>{{ user.phone }}</td>
      <td>{{ user.city }}</td>
      <td>{{ user.is_blocked}}</td>
      <td>
        <button *ngIf="!user.is_blocked && !user.showReason" (click)="user.showReason = true">
          Block
        </button>
        <button
          *ngIf="!user.is_blocked && user.showReason"
          (click)="blockUser(user._id)"
        >
          Confirm Block
        </button>
        <button *ngIf="user.is_blocked" (click)="unblockUser(user._id)">
          Unblock
        </button>
      </td>
    </tr>
  </tbody>
</table>