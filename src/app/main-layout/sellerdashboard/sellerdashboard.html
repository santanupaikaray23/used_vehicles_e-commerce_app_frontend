<div *ngIf="isLoading" class="spinner-container text-center">
  <img src="https://i.ibb.co/X3m7MyL/loader.gif" alt="Loading..." width="60" height="60" />
</div>
<div class="container">
    <form #vehicleForm="ngForm" (ngSubmit)="saveVehicle(vehicleForm)" novalidate>
    <p>Add your vehicle information below.</p>
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Title</mat-label>
        <input matInput [(ngModel)]="title" name="title" required #titleCtrl="ngModel">
        <mat-error *ngIf="titleCtrl.hasError('required')">
            Title is required.
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Make</mat-label>
        <input matInput [(ngModel)]="make" name="make" required #makeCtrl="ngModel">
        <mat-error *ngIf="makeCtrl.hasError('required')">
            Make is required.
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Model</mat-label>
        <input matInput [(ngModel)]="model" name="model" required #modelCtrl="ngModel">
        <mat-error *ngIf="modelCtrl.hasError('required')">
            Model is required.
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Variant</mat-label>
        <input matInput [(ngModel)]="variant" name="variant" required #variantCtrl="ngModel">
        <mat-error *ngIf="modelCtrl.hasError('required')">
            Variant is required.
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Year</mat-label>
        <input matInput type="number" [(ngModel)]="year" name="year" required #yearCtrl="ngModel">
        <mat-error *ngIf="modelCtrl.hasError('required')">
            Year is required.
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Mileage_KM</mat-label>
        <input matInput type="number" [(ngModel)]="mileage_km" name="mileage_km" required #mileage_kmCtrl="ngModel">
        <mat-error *ngIf="modelCtrl.hasError('required')">
            Mileage_KM is required.
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Fuel Type</mat-label>
        <mat-select [(ngModel)]="fueltype" name="fueltype" required #fueltypeCtrl="ngModel">
            <mat-option value="Petrol">Petrol</mat-option>
            <mat-option value="Diesel">Diesel</mat-option>
            <mat-option value="Electric">Electric</mat-option>
        </mat-select>
        <mat-error *ngIf="fueltypeCtrl.hasError('required')">
            Fuel Type is required.
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Transmission</mat-label>
        <mat-select [(ngModel)]="transmission" name="transmission" required #transmissionCtrl="ngModel">
            <mat-option value="Automatic">Automatic</mat-option>
            <mat-option value="Manual">Manual</mat-option>
            <mat-option value="Electric">Electric</mat-option>
        </mat-select>
        <mat-error *ngIf="transmissionCtrl.hasError('required')">
            Transmission is required.
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Owner Count</mat-label>
        <input matInput [(ngModel)]="ownercount" name="ownercount" required #ownercountCtrl="ngModel">
        <mat-error *ngIf="ownercountCtrl.hasError('required')">
            Ownercount is required.
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Registration State</mat-label>
        <input matInput [(ngModel)]="registrationstate" name="registrationstate" required #registrationstateCtrl="ngModel">
        <mat-error *ngIf="registrationstateCtrl.hasError('required')">
            Registrationstate is required.
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Set price to sell </mat-label>
        <input matInput [(ngModel)]="price" name="price" required #priceCtrl="ngModel">
        <mat-error *ngIf="priceCtrl.hasError('required')">
            Price is required.
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Description</mat-label>
        <input matInput [(ngModel)]="description" name="description" required #descriptionCtrl="ngModel">
        <mat-error *ngIf="descriptionCtrl.hasError('required')">
            Description is required
        </mat-error>

    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Location City</mat-label>
        <input matInput [(ngModel)]="locationcity" name="locationcity" required #cityCtrl="ngModel">

        <mat-error *ngIf="cityCtrl.hasError('required')">
            Location City is required
        </mat-error>
    </mat-form-field>&nbsp;
    <mat-form-field appearance="outline" class="form-field">
        <mat-label>Pincode</mat-label>
        <input matInput type="text" [(ngModel)]="localpincode" name="pincode" required pattern="^[0-9]{6}$" #pincodeCtrl="ngModel">

        <mat-error *ngIf="pincodeCtrl.hasError('required')">
            Pincode is required
        </mat-error>
        <mat-error *ngIf="pincodeCtrl.hasError('pattern')">
        Enter 6 digits Pincode
        </mat-error>
    </mat-form-field>&nbsp;
     <p>Please upload images smaller than 5,168 KB</p>
    <div class="upload-grid">
        <div class="upload-box" *ngFor="let photo of photos; let i = index" (click)="triggerFileInput(i)">
            <ng-container *ngIf="photo; else addPhoto">
                <img [src]="photo" alt="Preview" />
            </ng-container>
            <ng-template #addPhoto>
                <div class="add-photo">
                    <mat-icon>add_a_photo</mat-icon>
                    <span>Add Photo</span>
                </div>
            </ng-template>
            <input type="file" accept="image/*" #fileInput (change)="onFileSelected($event, i)" hidden />
        </div>
    </div>
    <div *ngIf="errorMessage" style="color:red; margin-top:8px;">
        {{ errorMessage }}
    </div>

    <div *ngIf="selectedFiles.length > 0" style="margin-top:12px;">
        <p><strong>Selected Files:</strong></p>
        <ul>
            <li *ngFor="let file of selectedFiles">
                {{ file.name }} ({{ file.size / 1024 | number:'1.0-0' }} KB)
            </li>
        </ul>
    </div> &nbsp;
    <div class="action-buttons">
        <button mat-raised-button color="primary" type="submit">
      {{ isEditMode ? 'Update' : 'Submit' }}
    </button>&nbsp;
     <button mat-raised-button color="warn" type="button" (click)="cancel()">
        Cancel
      </button>
    </div>
</form>
    <table mat-table [dataSource]="products" class="mat-elevation-z8 full-width-table">
        <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef> Title </th>
            <td mat-cell *matCellDef="let vehicle"> {{vehicle.title}} </td>
        </ng-container>
        <ng-container matColumnDef="make">
            <th mat-header-cell *matHeaderCellDef> Make </th>
            <td mat-cell *matCellDef="let vehicle"> {{vehicle.make}} </td>
        </ng-container>
        <ng-container matColumnDef="images">
            <th mat-header-cell *matHeaderCellDef> Images </th>
            <td mat-cell *matCellDef="let vehicle">
                <div class="image-list">
                    <img *ngFor="let img of vehicle.images" [src]="'data:' + img.mimetype + ';base64,' + img.data" [alt]="img.filename" width="20" height="20" />
                </div>
            </td>
        </ng-container>
        <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef> Action </th>
            <td mat-cell *matCellDef="let vehicle">
                <button mat-raised-button color="warn" (click)="updateVehicles(vehicle)">Edit</button>
                <button mat-raised-button color="warn" (click)="deleteVehicles(vehicle._id)">Delete</button>
       </ng-container>
       <!-- Audit Status -->
        <ng-container matColumnDef="auditStatus">
            <th mat-header-cell *matHeaderCellDef> Status </th>
            <td mat-cell *matCellDef="let product">
                {{ product.auditStatus }}
            </td>
        </ng-container>

        <ng-container matColumnDef="auditReason">
            <th mat-header-cell *matHeaderCellDef> Reason </th>
            <td mat-cell *matCellDef="let product">
                {{ product.auditReason }}
            </td>
        </ng-container>
          <ng-container matColumnDef="action2">
            <th mat-header-cell *matHeaderCellDef> Action </th>
            <td mat-cell *matCellDef="let vehicle">
               <button
  mat-raised-button
  color="primary"
  [routerLink]="['/sellerdashboard/buyerstatus', vehicle._id]">
  Buyer Status
</button>
       </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    
</div>